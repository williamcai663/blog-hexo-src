---
title: 分库分表总结
date: 2018-06-17 10:29:37
tags:
---

## 为什么要分库分表
当存储数据过多，性能下降，无法满足正常的业务需求的时候，就需要将单个空间拆分成多个，分担单个个体的压力，缩短响应时间，提高性能。
分库分表，顾名思义，是两个操作。
分库，拆分成多个数据库，分表，拆分成多张表。
常见方式有：单库单表->单库多表->多库多表。

## 如何进行数据拆分
最简单的方式就是按照ID将数据分配到不同的库不同的表中。
当你创建一条记录时，就会根据生成的ID计算这条数据放到哪个库哪张表里去。
## 分库分表路由规则
假如有16个库（从00库到15库），每个库有64张表，那一共就是有1024张表（从0000-1023）
对应的路由规则：
dbRule=id%1024%64
tbRule=id%1024
那么对应的库为dbName_dbRule
对应的表为：tbName_tbRule

### 常见的方式
 - 简单ID取模
 - 字符串hash取模

## 分表键的问题

选择谁作为分表键，这涉及到数据库的可扩展性，是否便于查询，能够避免跨库事务等，如果数据老是落到特定的数据库表中，那就分库分表就没有意义了。
这个问题没有明确的答案，必须根据实际业务来确定。建议分表键尽可能找到数据表中的数据在业务逻辑上的主体，并确定大部分的数据库围绕这个主体的数据进行。如果一个分表键无法解决，可以使用2个，尽量越少越好。

## 分库分表存在的问题
- 数据按照用户划分，就会造成跨库事务问题。
- 原来所有的单库单表的sql都要进行改造，加入appId分表键。
- 汇总分库分表的数据，要跨越多个库，是一个问题。
